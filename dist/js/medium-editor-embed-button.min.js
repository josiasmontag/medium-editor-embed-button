!function(e,t,s){"use strict";function o(e){if(e&&"FORM"===e.nodeName){var t,s={};return Array.prototype.slice.call(e.elements).forEach(function(e){if(""!==e.name)switch(e.nodeName){case"INPUT":switch(e.type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":s[e.name]=e.value;break;case"checkbox":case"radio":e.checked&&(s[e.name]=e.value)}break;case"file":break;case"TEXTAREA":s[e.name]=e.value;break;case"SELECT":switch(e.type){case"select-one":s[e.name]=e.value;break;case"select-multiple":var o=[];for(t=e.options.length-1;t>=0;t-=1)e.options[t].selected&&o.push(e.options[t].value);s[e.name]=o}break;case"BUTTON":switch(e.type){case"reset":case"submit":case"button":s[e.name]=e.value}}}),s}}function i(e,t){for(var s,o,i=/<%(.+?)%>/g,n=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,a="with(obj) { var r=[];\n",r=0,d=function(e,t){return a+=t?e.match(n)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",d};o=i.exec(e);)d(e.slice(r,o.index))(o[1],!0),r=o.index+o[0].length;d(e.substr(r,e.length-r)),a=(a+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{s=new Function("obj",a).apply(t,[t])}catch(e){console.error("'"+e.message+"'"," in \n\nCode:\n",a,"\n")}return s}function n(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function a(e,t,s){function o(t,s){return r.set(e,t,s),a}function i(t){return r.del(e,t),a}function n(t){return r.get(e,t)}var a={set:o,get:n,del:i};return 3===arguments.length?o(t,s):2==arguments.length?n(t):a}var r;if(r=void 0!==t&&t.head&&t.head.dataset?{set:function(e,t,s){e.dataset[t]=s},get:function(e,t){return e.dataset[t]},del:function(e,t){delete e.dataset[t]}}:{set:function(e,t,s){e.setAttribute("data-"+n(t),s)},get:function(e,t){return e.getAttribute("data-"+n(t))},del:function(e,t){e.removeAttribute("data-"+n(t))}},"function"!=typeof s)throw new Error("Medium Editor is not loaded on the page.");var d={name:"embedButton",action:"embedAction",contentDefault:"E",contentFA:'<i class="fa fa-youtube-play"></i>',aria:"Embed media",defaults:{msgSelectOnlyUrl:"Selected text is not a valid URL!",msgSelectOnlyEmbadableUrl:"Selected URL is not supported!",msgMakeItVideoEmbed:"Embed video",msgTwitterEmbedModalTitle:"Twitter Embed Options",msgHideTweetStatusMessage:"Hide tweet text",msgInsertEmbed:"Embed ekle",oembedProxy:"http://iframe.ly/api/oembed?api_key=APIKEY_HERE&url=",cssEmbedOverlay:"medium-editor-embeds-overlay",cssEmbeds:"medium-editor-embeds",cssSelected:"medium-editor-embeds-selected",cssEmbedModal:"medium-editor-embeds__modal",instagramEmbedScript:"//platform.instagram.com/en_US/embeds.js",twitterEmbedScripts:"//platform.twitter.com/widgets.js",facebookEmbedScripts:"//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7",iframelyEmbedScript:"//cdn.iframe.ly/embed.js",vimeoEmbedScripts:""},init:function(){s.extensions.button.prototype.init.call(this),this.opts=s.util.extend({},this.defaults,this.embedOpts);var e=this,t=e.document,o=t.querySelectorAll("."+e.opts.cssEmbeds);if(this.base._originalSerializerPreEmbeds=e.base.serialize,this.base.serialize=e.embedSerialize,this.base.embedModal=null,this.attachEvents(),void 0!==o&&null!==o&&0!==o.length){for(var i=[],n=0;n<e.base.elements.length;n++){var a=e.base.elements[n],r=a.querySelectorAll("."+e.opts.cssEmbeds);i=i.concat(Array.prototype.slice.call(r))}for(var n=0;n<i.length;n++){var d=i[n];d.setAttribute("contenteditable",!1),null===d.querySelector("."+e.opts.cssEmbedOverlay)&&e.appendOverlay(d)}}},attachEvents:function(){this.on(this.document,"click",this.unselectEmbed.bind(this));var e=this.document.querySelectorAll("."+this.opts.cssEmbeds);this.on(e,"click",this.selectEmbed.bind(this)),this.on(this.document,"keydown",this.removeEmbed.bind(this)),this.on(this.base.elements,"keydown",this.deleteEmbedOnBackspaceAndDel.bind(this))},ajaxGet:function(e,s,o){var i=new XMLHttpRequest;return i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?s.apply(i,[JSON.parse(i.responseText)]):400===i.status||void 0!==o&&o.apply(i))},i.open("GET",e,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Access-Control-Allow-Origin","*"),i.setRequestHeader("Referrer",t.location.href),i.send(),i},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this,o={},i=s.selection.getSelectionRange(t.document);if("a"===i.startContainer.nodeName.toLowerCase()||"a"===i.endContainer.nodeName.toLowerCase()||s.util.getClosestTag(s.selection.getSelectedParentElement(i),"a"))return t.execAction("unlink");if("#text"!==i.startContainer.nodeName.toLowerCase()&&"#text"!==i.endContainer.nodeName.toLowerCase())return alert(t.opts.msgSelectOnlyUrl),!1;var n=this.getSelection();return t.base.saveSelection(),n.indexOf("http:")<0&&n.indexOf("https:")<0?(alert(t.opts.msgSelectOnlyUrl),!1):(o.selectedText=n,n.indexOf("twitter")>-1?(o.embedSource="twitter",void t.openEmbedModal(o)):(n.indexOf("youtube")>-1?o.embedSource="youtube":n.indexOf("instagram")>-1&&(o.embedSource="instagram"),void t.getAjaxResultAndPaste(i,o)))},openEmbedModal:function(e){var t=this,s=t.document,o=s.createElement("div"),n='<div class="<%cssEmbedModal%>"><div class="<%cssEmbedModalInner%>"><a href="" class="<%cssEmbedModalClose%>">&times;</a><div class="<%cssEmbedModalHeader%>"><h2><%msgTwitterEmbedModalTitle%></h2></div><div class="<%cssEmbedModalBody%>"><form class="<%cssEmbedModalForm%>"><input type="hidden" name="selectedText" value="<%selectedText%>" /><input type="hidden" name="embedSource" value="<%embedSource%>" />';switch(e.embedSource){case"twitter":n+='<p><label><input type="checkbox" name="tweetAsVideo" value="true" /> <%msgMakeItVideoEmbed%></label></p><p><label>'}n+='</form></div><div class="<%cssEmbedModalFooter%>"><button class="<%cssEmbedModal%>-submit"><%msgInsertEmbed%></button></div></div></div>';var a=i(n,{cssEmbedModal:t.opts.cssEmbedModal,cssEmbedModalInner:t.opts.cssEmbedModal+"-inner",cssEmbedModalClose:t.opts.cssEmbedModal+"-close",cssEmbedModalHeader:t.opts.cssEmbedModal+"-header",cssEmbedModalBody:t.opts.cssEmbedModal+"-body",cssEmbedModalForm:t.opts.cssEmbedModal+"-form",cssEmbedModalFooter:t.opts.cssEmbedModal+"-footer",selectedText:e.selectedText,embedSource:e.embedSource,msgMakeItVideoEmbed:t.opts.msgMakeItVideoEmbed,msgTwitterEmbedModalTitle:t.opts.msgTwitterEmbedModalTitle,msgInsertEmbed:t.opts.msgInsertEmbed,msgHideTweetStatusMessage:t.opts.msgHideTweetStatusMessage});o.innerHTML=a,this.base.embedModal=o,s.body.appendChild(o);var r=o.querySelector("."+t.opts.cssEmbedModal+"-close"),d=o.querySelector("."+t.opts.cssEmbedModal+"-submit");this.on(r,"click",this.closeAndDestroyModal.bind(this)),this.on(d,"click",this.submitEmbedModal.bind(this))},closeAndDestroyModal:function(e){e.preventDefault();var t=this,s=t.document,o=s.querySelector("."+t.opts.cssEmbedModal);this.base.embedModal=null,void 0!==o&&o.parentNode.removeChild(o)},submitEmbedModal:function(e){e.preventDefault();var t=this,i=t.document,n=i.querySelector("."+t.opts.cssEmbedModal),a=n.querySelector("form"),r=s.selection.getSelectionRange(t.document),d=o(a);t.getAjaxResultAndPaste(r,d),t.closeAndDestroyModal(e)},getSelection:function(){var s="";return e.getSelection?s=e.getSelection().toString():t.getSelection?s=t.getSelection().toString():t.selection&&(s=t.selection.createRange().text),s},appendOverlay:function(e){var t=this.document.createElement("div");t.className=this.opts.cssEmbedOverlay,e.appendChild(t)},getAjaxResultAndPaste:function(e,t){var s=this,o=s.opts.oembedProxy+t.selectedText;s.base.restoreSelection(),s.ajaxGet(o,function(o){e.deleteContents(),o.url=t.selectedText,s.insertEmbed(e,o,t)})},embedFailback:function(e){return e.html=e.url.replace(/\n?/g,"").replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/,'<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>').replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/,'<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/,'<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>').replace(/^(https:\/\/www\.facebook\.com\/(.*))$/,'<script src="//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2" async><\/script><div class="fb-post" data-href="$1"><div class="fb-xfbml-parse-ignore"><a href="$1">Loading Facebook post...</a></div></div>').replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/,'<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>'),e},insertEmbed:function(e,t,o){var i=this,n=s.util.guid(),r=i.document.createElement("div");if(r.setAttribute("id",n),r.setAttribute("contenteditable",!1),void 0===t||void 0!==t.html&&null!=t.html||(t=i.embedFailback(t)),void 0!==o&&"twitter"===o.embedSource&&"true"===o.tweetAsVideo){var d=i.document.createElement("div");d.innerHTML=t.html;var l=d.querySelector("blockquote");l.classList.remove("twitter-tweet"),l.classList.add("twitter-video"),void 0!==o.hideStatus&&"true"===o.hideStatus?a(l,"status","hidden"):a(l,"status","show"),t.html=l.outerHTML}a(r,"originalResponse",JSON.stringify(t)),r.className=i.opts.cssEmbeds,r.innerHTML=t.html,i.appendOverlay(r),i.base.pasteHTML(i.getHtml(r),{cleanAttrs:[],cleanTags:[]});var c=i.document.getElementById(n);if(null!==c){var m=c.querySelector("."+i.opts.cssEmbedOverlay);this.on(m,"click",this.selectEmbed.bind(this))}i.base.checkContentChanged(),i.parseSiteSpecific(t)},loadIfIframely:function(){void 0!==this.opts.oembedProxy&&this.opts.oembedProxy.indexOf("iframely")&&this.injectScript(this.opts.iframelyEmbedScript)},parseSiteSpecific:function(t){var s=this;if(t.url.indexOf("instagr")>-1){if(void 0===e.instgrm)return void s.injectScript(s.opts.instagramEmbedScript);e.instgrm.Embeds.process()}else if(t.url.indexOf("twitter")>-1){if(void 0===e.twttr)return void s.injectScript(s.opts.twitterEmbedScripts);e.twttr.widgets.load()}else s.loadIfIframely()},selectEmbed:function(e){e.preventDefault(),e.stopPropagation();var t=this,s=e.target,o=s.parentElement;if(!o.classList.contains(t.opts.cssSelected)){var i=t.document.querySelectorAll("."+t.opts.cssEmbeds);void 0!==i&&null!==i&&i.forEach(function(e){e.classList.remove(t.opts.cssSelected)}),o.classList.add(t.opts.cssSelected)}},unselectEmbed:function(e){var t=this,s=e.target,o=t.document.querySelectorAll("."+t.opts.cssEmbeds);if(void 0!==o&&null!==o&&0!==o.length&&!s.classList.contains(t.opts.cssEmbedOverlay))for(var i=0;i<o.length;i++){var n=o[i];n.classList.remove(t.opts.cssSelected)}},removeEmbed:function(e){var t,o=this;if(s.util.isKey(e,[s.util.keyCode.BACKSPACE,s.util.keyCode.DELETE])&&null!==(t=o.document.querySelector("."+o.opts.cssSelected))){e.preventDefault();var i=o.document.createElement("p");t.parentElement.insertBefore(i,t),t.parentElement.removeChild(t)}},deleteEmbedOnBackspaceAndDel:function(e){if(s.util.isKey(e,[s.util.keyCode.DELETE,s.util.keyCode.BACKSPACE])){var t=s.selection.getSelectionStart(this.base.options.ownerDocument),o=this,i=s.selection.getSelectionRange(o.document),n=s.util.getClosestTag(s.selection.getSelectedParentElement(i),"p");if(!(s.selection.getCaretOffsets(t).left>0)){var a=n.previousSibling;if(void 0!==a&&void 0!==a.classList&&a.classList.contains(o.opts.cssEmbeds)){e.preventDefault(),e.stopPropagation();var r=o.document.createElement("p");a.parentElement.insertBefore(r,a),a.parentElement.removeChild(a)}}}},embedSerialize:function(){var e=this,t=e._originalSerializerPreEmbeds(),s=e.options.ownerDocument,o=e.getExtensionByName("embedButton");for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r=s.createElement("div");r.innerHTML=n.value;var d=r.querySelectorAll("."+o.opts.cssEmbeds);if(void 0!==d&&null!==d&&d.length>0)for(var l=0;l<d.length;l++){var c=d[l],m=a(c,"originalResponse");if(m&&null!==m){var u=JSON.parse(m);c.innerHTML=u.html;var b={html:u.html,url:u.url};a(c).set("originalResponse",JSON.stringify(b))}else{var p=c.querySelector("."+o.opts.cssEmbedOverlay);null!==p&&p.parentElement.removeChild(p)}c.removeAttribute("contenteditable"),c.classList.remove(o.opts.cssSelected)}t[i].value=r.innerHTML}return t},getHtml:function(e){var t=this.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},injectScript:function(e){var t=this.document.createElement("script");t.type="text/javascript",t.async=!0,t.onLoad=function(){},t.src=this.document.location.protocol+e,this.document.getElementsByTagName("head")[0].appendChild(t)}},l=s.extensions.button.extend(d);"undefined"!=typeof module&&void 0!==module.exports?module.exports=l:"function"==typeof define&&define.amd?define([],function(){return l}):e.EmbedButtonExtension=l}(window,document,"function"==typeof require?require("medium-editor"):MediumEditor);
//# sourceMappingURL=medium-editor-embed-button.js.map
